<div class="container--default max-w-3xl mx-auto text-xs sm:text-sm">
  <ng-container *ngIf="allUsers$ | async as allUsers; else loadingUsers">
    <ng-container
      *ngFor="let userGroups of allUsers | groupBy: 'role'; trackBy: trackByKey"
    >
      <h1 class="text-headline border-b my-6 pb-8">
        {{ userGroups.key | titlecase }}
      </h1>
      <div
        [id]="user.uid"
        class="flex justify-between items-baseline rounded-full px-6 py-4 mb-2 space-x-4"
        *ngFor="let user of userGroups.value; trackBy: trackByUid"
        [ngClass]="[user.disabled ? 'bg-yellow-200' : 'bg-gray-200']"
      >
        <div class="w-1/3 overflow-hidden overflow-ellipsis">
          {{ user.displayName }}
        </div>
        <div class="flex-auto text-right text-gray-800">{{ user.email }}</div>
        <select
          [id]="'select-role-' + user.uid"
          [value]="user.role"
          class="py-1 text-xs rounded-full border-none"
          (change)="onRoleChange(user.uid, $any($event.target))"
        >
          <option value="user">User</option>
          <option value="jury">Jury</option>
          <option value="team">Team</option>
        </select>

        <button
          (click)="toggleUserStatus(user.uid, !user.disabled)"
          class="text-xxs font-mono underline"
          [innerText]="
            (user.disabled ? 'actions.enable' : 'actions.disable')
              | translate
              | uppercase
          "
        ></button>
        <button
          *ngIf="user.disabled"
          (click)="deleteUser(user.uid)"
          class="text-xxs font-mono underline text-red-700"
          [innerText]="'actions.delete' | translate | uppercase"
        ></button>
      </div>
    </ng-container>
  </ng-container>
  <!-- <div class="col-span-3">
    {{ artistUsers$ | async | json }}
  </div> -->
</div>
<div class="container--default font-display bg-gray-200 max-w-3xl mx-auto">
  <h1 class="text-headline pb-4">{{ "snippets.add-user" | translate }}:</h1>
  <button
    class="flex justify-between items-baseline w-full rounded-full bg-black text-white pl-6 pr-2 py-2 text-left mb-2 space-x-4"
    *ngFor="let user of newUsers"
    [cdkCopyToClipboard]="user.password"
  >
    <div class="w-1/3 overflow-hidden overflow-ellipsis">
      {{ user.displayName }}
    </div>
    <div class="flex-auto text-right text-gray-300">{{ user.email }}</div>
    <div class="flex-auto text-right text-gray-300">{{ user.role }}</div>
    <div class="whitespace-nowrap py-2 px-4 bg-white text-black rounded-full">
      PW: <code class="font-mono">{{ user.password }}</code>
    </div>
  </button>

  <form
    class="flex justify-between items-baseline space-x-4 mt-2 relative"
    [formGroup]="newUserForm"
    (ngSubmit)="createUser()"
  >
    <input
      class="appearance-none rounded-none relative block w-full p-2 border-solid bg-gray-50 border-b border-t-0 border-r-0 border-l-0 border-transparent font-mono placeholder-gray-500 text-black focus:outline-none focus:ring-gray-500 focus:border-gray-500 focus:z-10 text-xs sm:text-sm"
      id="new-user-displayName"
      formControlName="displayName"
      name="displayName"
      type="text"
      required
      [ngClass]="[
        displayName.touched && displayName.invalid ? 'bg-red-100' : 'bg-gray-50'
      ]"
      [placeholder]="'defaults.name-single' | translate"
    />
    <input
      class="appearance-none rounded-none relative block w-full p-2 border-solid bg-gray-50 border-b border-t-0 border-r-0 border-l-0 border-transparent font-mono placeholder-gray-500 text-black focus:outline-none focus:ring-gray-500 focus:border-gray-500 focus:z-10 text-xs sm:text-sm"
      id="new-user-email"
      formControlName="email"
      name="email"
      type="email"
      required
      [ngClass]="[email.touched && email.invalid ? 'bg-red-100' : 'bg-gray-50']"
      [placeholder]="'defaults.email-single' | translate"
    />
    <select
      class="py-1 text-xs rounded-full border-none"
      id="new-user-role"
      formControlName="role"
    >
      <option value="user">User</option>
      <option value="jury">Jury</option>
      <option value="team">Team</option>
    </select>
    <button
      type="submit"
      class="text-xxs font-mono underline whitespace-nowrap"
    >
      {{ "actions.add" | translate | uppercase }} +
    </button>
  </form>
  <div class="px-4 text-xs font-mono text-red-600 leading-tight">
    <p
      *ngIf="displayName.touched && displayName.invalid"
      class="mt-2 truncate"
      id="name-error"
      [innerHtml]="'snippets.auth.name-error' | translate"
    ></p>
    <p
      *ngIf="email.touched && email.invalid"
      class="mt-2 truncate"
      id="email-error"
      [innerHtml]="'snippets.auth.email-error' | translate"
    ></p>
  </div>
</div>
<ng-template #loadingUsers>
  <div
    class="flex justify-between items-baseline space-x-4 rounded-full bg-gray-200 px-6 py-4 mb-2 animate-pulse"
  >
    <div class="w-1/3 h-5 bg-gray-300 rounded-full">&nbsp;</div>
    <div class="w-2/3 h-5 bg-gray-300 rounded-full">&nbsp;</div>
  </div>
</ng-template>
