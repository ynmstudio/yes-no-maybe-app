fragment Edition on editions {
  id
  name
  current
  application_end
  application_start
  applications_aggregate {
    aggregate {
      count
    }
  }
}

query GetEdition {
  editions(where: { current: { _eq: true } }) {
    ...Edition
  }
}

# Admin
query GetAllEditions {
  editions {
    ...Edition
  }
}
query GetEditionStatistic($id: Int!) {
  applications_total: applications_aggregate(
    where: { edition: { id: { _eq: $id } } }
  ) {
    aggregate {
      count
    }
  }
  applications_untouched: applications_aggregate(
    where: {
      _and: {
        edition: { id: { _eq: $id } }
        _and: [
          { _not: { files: {} } }
          { _not: { specifications: {} } }
          { _not: { payment: {} } }
          { disclaimer: { _eq: false } }
        ]
      }
    }
  ) {
    aggregate {
      count
    }
  }
  applications_edited: applications_aggregate(
    where: {
      _and: {
        edition: { id: { _eq: $id } }
        _or: [
          { files: {} }
          { specifications: {} }
          { payment: {} }
          { disclaimer: { _eq: true } }
        ]
      }
    }
  ) {
    aggregate {
      count
    }
  }
  applications_ready: applications_aggregate(
    where: {
      _and: {
        edition: { id: { _eq: $id } }
        _and: [
          { files: {} }
          { specifications: {} }
          { payment: {} }
          { disclaimer: { _eq: true } }
        ]
      }
    }
  ) {
    aggregate {
      count
    }
  }
  payments_aggregate(
    where: { application: { edition: { id: { _eq: $id } } } }
  ) {
    aggregate {
      count
    }
  }
}

mutation CreateEdition($name: String!) {
  insert_editions_one(object: { name: $name }) {
    ...Edition
  }
}
mutation RenameEdition($id: Int!, $name: String!) {
  update_editions_by_pk(pk_columns: { id: $id }, _set: { name: $name }) {
    ...Edition
  }
}

mutation SetCurrentEdition($id: Int!) {
  update_editions(_set: { current: null }, where: { current: { _eq: true } }) {
    affected_rows
  }
  update_editions_by_pk(pk_columns: { id: $id }, _set: { current: true }) {
    ...Edition
  }
}
mutation DisableEditions {
  update_editions(_set: { current: null }, where: { current: { _eq: true } }) {
    affected_rows
  }
}
