fragment Payment on payments {
  id
  mimetype
  key
  originalname
  size
  application_id
}

fragment Application on applications {
  id
  name
  group
  created_at
  updated_at
  statement
  residency
  database
  disclaimer
  locked
  ready
  state
  payment {
    ...Payment
  }
  edition {
    id
    name
  }
  files_aggregate {
    aggregate {
      count
      sum {
        size
      }
    }
  }
  works_aggregate {
    aggregate {
      count
    }
  }
}
# User

query GetApplications {
  applications(order_by: { created_at: asc_nulls_first }) {
    ...Application
  }
  applications_aggregate {
    aggregate {
      count
    }
  }
}
query GetApplication($id: uuid!) {
  applications_by_pk(id: $id) {
    ...Application
  }
}
mutation AddApplication($edition_id: Int!) {
  insert_applications_one(
    object: {
      edition_id: $edition_id
      user: {
        data: {}
        on_conflict: { constraint: users_pkey, update_columns: last_seen }
      }
    }
  ) {
    id
  }
}

mutation UpdateApplication($id: uuid!, $data: applications_set_input!) {
  update_applications_by_pk(pk_columns: { id: $id }, _set: $data) {
    ...Application
  }
}
mutation LockApplication($id: uuid!) {
  update_applications_by_pk(pk_columns: { id: $id }, _set: { locked: true }) {
    id
    locked
  }
}
mutation UnlockApplication($id: uuid!) {
  update_applications_by_pk(pk_columns: { id: $id }, _set: { locked: false }) {
    id
    locked
  }
}
mutation DeleteApplication($id: uuid!) {
  delete_applications_by_pk(id: $id) {
    id
  }
}

mutation AddPayment(
  $application_id: uuid!
  $id: uuid!
  $key: String!
  $mimetype: String!
  $originalname: String!
  $size: numeric!
) {
  update_applications_by_pk(
    pk_columns: { id: $application_id }
    _set: { updated_at: "now()" }
  ) {
    id
    updated_at
  }
  insert_payments_one(
    object: {
      application_id: $application_id
      id: $id
      key: $key
      mimetype: $mimetype
      size: $size
      originalname: $originalname
    }
  ) {
    ...Payment
  }
}
mutation DeletePayment($id: uuid!, $application_id: uuid!) {
  update_applications_by_pk(
    pk_columns: { id: $application_id }
    _set: { updated_at: "now()" }
  ) {
    id
    updated_at
  }
  delete_payments_by_pk(id: $id) {
    id
    application_id
  }
}

# Jury

# Admin
