- table:
    name: applications
    schema: public
  object_relationships:
    - name: edition
      using:
        foreign_key_constraint_on: edition_id
    - name: elimination
      using:
        manual_configuration:
          column_mapping:
            id: application_id
          insertion_order: null
          remote_table:
            name: eliminations
            schema: public
    - name: payment
      using:
        manual_configuration:
          column_mapping:
            id: application_id
          insertion_order: null
          remote_table:
            name: payments
            schema: public
    - name: rating_in_latest_round
      using:
        manual_configuration:
          column_mapping:
            id: id
          insertion_order: null
          remote_table:
            name: ratings_by_application
            schema: public
    - name: user
      using:
        foreign_key_constraint_on: created_by
  array_relationships:
    - name: files
      using:
        foreign_key_constraint_on:
          column: application_id
          table:
            name: work_files
            schema: public
    - name: messages
      using:
        foreign_key_constraint_on:
          column: application_id
          table:
            name: messages
            schema: public
    - name: ratings
      using:
        foreign_key_constraint_on:
          column: application_id
          table:
            name: ratings
            schema: public
    - name: specifications
      using:
        foreign_key_constraint_on:
          column: application_id
          table:
            name: work_specifications
            schema: public
    - name: works
      using:
        foreign_key_constraint_on:
          column: application_id
          table:
            name: works
            schema: public
  computed_fields:
    - name: rated_by_user
      definition:
        function:
          name: application_rated_by_user
          schema: public
        session_argument: hasura_session
        table_argument: application_row
    - name: ready
      definition:
        function:
          name: application_is_ready
          schema: public
      comment: ""
    - name: state
      definition:
        function:
          name: application_state
          schema: public
      comment: ""
    - name: winner
      definition:
        function:
          name: application_is_winner
          schema: public
      comment: ""
  insert_permissions:
    - role: user
      permission:
        check:
          edition:
            _and:
              - current:
                  _eq: true
              - application_start:
                  _lte: now()
              - application_end:
                  _gte: now()
        set:
          created_by: x-hasura-user-id
        columns:
          - edition_id
          - name
  select_permissions:
    - role: jury
      permission:
        columns:
          - created_at
          - created_by
          - edition_id
          - group
          - id
          - internal_name
          - locked
          - statement
          - updated_at
        computed_fields:
          - rated_by_user
          - ready
          - state
          - winner
        filter:
          edition:
            current:
              _eq: true
        allow_aggregations: true
    - role: team
      permission:
        columns:
          - applicant_details
          - applicant_details_valid
          - created_at
          - created_by
          - database
          - disclaimer
          - edition_id
          - group
          - id
          - internal_name
          - locked
          - name
          - residency
          - statement
          - updated_at
        computed_fields:
          - rated_by_user
          - ready
          - state
          - winner
        filter: {}
        allow_aggregations: true
    - role: user
      permission:
        columns:
          - applicant_details
          - applicant_details_valid
          - created_at
          - created_by
          - database
          - disclaimer
          - edition_id
          - group
          - id
          - locked
          - name
          - residency
          - statement
          - updated_at
        computed_fields:
          - ready
          - state
        filter:
          _and:
            - edition:
                current:
                  _eq: true
            - created_by:
                _eq: X-Hasura-User-Id
        allow_aggregations: true
  update_permissions:
    - role: team
      permission:
        columns:
          - internal_name
        filter: {}
        check: null
    - role: user
      permission:
        columns:
          - applicant_details
          - applicant_details_valid
          - database
          - disclaimer
          - group
          - locked
          - name
          - residency
          - statement
          - updated_at
        filter:
          _and:
            - created_by:
                _eq: X-Hasura-User-Id
            - edition:
                _and:
                  - current:
                      _eq: true
                  - application_start:
                      _lte: now()
        check: null
  delete_permissions:
    - role: user
      permission:
        filter:
          _and:
            - created_by:
                _eq: X-Hasura-User-Id
            - edition:
                _and:
                  - current:
                      _eq: true
                  - application_start:
                      _lte: now()
                  - application_end:
                      _gte: now()
            - locked:
                _eq: false
- table:
    name: category_mediums
    schema: public
  array_relationships:
    - name: specifications
      using:
        foreign_key_constraint_on:
          column: medium_id
          table:
            name: work_specification_mediums
            schema: public
  insert_permissions:
    - role: team
      permission:
        check: {}
        columns:
          - name_de
          - name_en
  select_permissions:
    - role: jury
      permission:
        columns:
          - name_de
          - name_en
          - id
        filter: {}
        allow_aggregations: true
    - role: team
      permission:
        columns:
          - name_de
          - name_en
          - id
        filter: {}
        allow_aggregations: true
    - role: user
      permission:
        columns:
          - name_de
          - name_en
          - id
        filter: {}
  update_permissions:
    - role: team
      permission:
        columns:
          - name_de
          - name_en
        filter: {}
        check: null
  delete_permissions:
    - role: team
      permission:
        filter: {}
- table:
    name: category_tags
    schema: public
  insert_permissions:
    - role: team
      permission:
        check: {}
        columns: []
  select_permissions:
    - role: jury
      permission:
        columns:
          - id
          - name_en
          - name_de
        filter: {}
        allow_aggregations: true
    - role: team
      permission:
        columns:
          - name_de
          - name_en
          - id
        filter: {}
        allow_aggregations: true
    - role: user
      permission:
        columns:
          - name_de
          - name_en
          - id
        filter: {}
  update_permissions:
    - role: team
      permission:
        columns: []
        filter: {}
        check: null
  delete_permissions:
    - role: team
      permission:
        filter: {}
- table:
    name: editions
    schema: public
  object_relationships:
    - name: winner
      using:
        foreign_key_constraint_on: winner_id
  array_relationships:
    - name: applications
      using:
        foreign_key_constraint_on:
          column: edition_id
          table:
            name: applications
            schema: public
    - name: rating_rounds
      using:
        foreign_key_constraint_on:
          column: edition_id
          table:
            name: rating_rounds
            schema: public
    - name: updates
      using:
        foreign_key_constraint_on:
          column: edition_id
          table:
            name: updates
            schema: public
  computed_fields:
    - name: state
      definition:
        function:
          name: edition_state
          schema: public
      comment: ""
  insert_permissions:
    - role: team
      permission:
        check: {}
        columns:
          - application_end
          - application_start
          - current
          - name
  select_permissions:
    - role: jury
      permission:
        columns:
          - application_end
          - application_start
          - current
          - id
          - name
          - winner_id
        computed_fields:
          - state
        filter:
          current:
            _eq: true
        limit: 1
    - role: team
      permission:
        columns:
          - application_end
          - application_start
          - created_at
          - current
          - id
          - name
          - winner_id
        computed_fields:
          - state
        filter: {}
        allow_aggregations: true
    - role: user
      permission:
        columns:
          - application_end
          - application_start
          - current
          - id
          - name
        computed_fields:
          - state
        filter:
          current:
            _eq: true
        limit: 1
  update_permissions:
    - role: team
      permission:
        columns:
          - application_end
          - application_start
          - current
          - name
          - winner_id
        filter:
          winner_id:
            _is_null: true
        check:
          _or:
            - _and:
                - winner_id:
                    _is_null: true
                - _not:
                    rating_rounds: {}
            - winner:
                edition_id:
                  _ceq:
                    - $
                    - id
  delete_permissions:
    - role: team
      permission:
        filter: {}
- table:
    name: eliminations
    schema: public
  object_relationships:
    - name: application
      using:
        foreign_key_constraint_on: application_id
    - name: eliminated_by
      using:
        foreign_key_constraint_on: created_by
    - name: rating_round
      using:
        foreign_key_constraint_on: round_id
  insert_permissions:
    - role: team
      permission:
        check:
          application:
            _and:
              - edition:
                  current:
                    _eq: true
        set:
          created_by: x-hasura-User-Id
        columns:
          - application_id
          - reason
          - round_id
  select_permissions:
    - role: jury
      permission:
        columns:
          - round_id
          - created_by
          - reason
          - created_at
          - application_id
        filter: {}
        allow_aggregations: true
    - role: team
      permission:
        columns:
          - round_id
          - created_by
          - reason
          - created_at
          - application_id
        filter: {}
        allow_aggregations: true
  delete_permissions:
    - role: team
      permission:
        filter:
          application:
            _and:
              - edition:
                  current:
                    _eq: true
- table:
    name: messages
    schema: public
  object_relationships:
    - name: application
      using:
        foreign_key_constraint_on: application_id
    - name: rating
      using:
        manual_configuration:
          column_mapping:
            id: message_id
          insertion_order: null
          remote_table:
            name: ratings
            schema: public
    - name: rating_round
      using:
        foreign_key_constraint_on: round_id
    - name: user
      using:
        foreign_key_constraint_on: created_by
  insert_permissions:
    - role: jury
      permission:
        check: {}
        set:
          created_by: x-hasura-User-Id
        columns:
          - application_id
          - round_id
          - text
    - role: team
      permission:
        check: {}
        set:
          created_by: x-hasura-User-Id
        columns:
          - application_id
          - round_id
          - text
  select_permissions:
    - role: jury
      permission:
        columns:
          - application_id
          - created_at
          - id
          - round_id
          - text
        filter:
          application_id:
            _is_null: false
        allow_aggregations: true
    - role: team
      permission:
        columns:
          - application_id
          - created_at
          - id
          - round_id
          - text
        filter:
          application_id:
            _is_null: false
        allow_aggregations: true
  delete_permissions:
    - role: jury
      permission:
        filter:
          created_by:
            _eq: X-Hasura-User-Id
    - role: team
      permission:
        filter:
          created_by:
            _eq: X-Hasura-User-Id
- table:
    name: payments
    schema: public
  object_relationships:
    - name: application
      using:
        foreign_key_constraint_on: application_id
  insert_permissions:
    - role: user
      permission:
        check:
          application:
            created_by:
              _eq: X-Hasura-User-Id
        columns:
          - application_id
          - id
          - key
          - mimetype
          - originalname
          - size
  select_permissions:
    - role: team
      permission:
        columns:
          - id
          - created_at
          - key
          - mimetype
          - originalname
          - application_id
          - size
        filter: {}
        allow_aggregations: true
    - role: user
      permission:
        columns:
          - size
          - key
          - mimetype
          - originalname
          - created_at
          - application_id
          - id
        filter:
          application:
            created_by:
              _eq: X-Hasura-User-Id
        allow_aggregations: true
  delete_permissions:
    - role: user
      permission:
        filter:
          application:
            _and:
              - created_by:
                  _eq: X-Hasura-User-Id
              - edition:
                  application_end:
                    _gte: now()
  event_triggers:
    - name: delete_firebase_storage_payment_file
      definition:
        delete:
          columns: '*'
        enable_manual: false
      retry_conf:
        interval_sec: 10
        num_retries: 0
        timeout_sec: 60
      webhook: '{{FIREBASE_FUNCTION_ENDPOINT}}/deleteFile'
      headers:
        - name: x-hasura-shared-secret
          value_from_env: FIREBASE_SHARED_SECRET
- table:
    name: rating_rounds
    schema: public
  object_relationships:
    - name: edition
      using:
        foreign_key_constraint_on: edition_id
    - name: next_round
      using:
        manual_configuration:
          column_mapping:
            id: prev_round_id
          insertion_order: null
          remote_table:
            name: rating_rounds
            schema: public
    - name: prev_round
      using:
        foreign_key_constraint_on: prev_round_id
  array_relationships:
    - name: eliminations
      using:
        foreign_key_constraint_on:
          column: round_id
          table:
            name: eliminations
            schema: public
    - name: ratings
      using:
        foreign_key_constraint_on:
          column: round_id
          table:
            name: ratings
            schema: public
  computed_fields:
    - name: active
      definition:
        function:
          name: rating_round_state
          schema: public
      comment: ""
    - name: level
      definition:
        function:
          name: get_rating_round_level
          schema: public
  insert_permissions:
    - role: team
      permission:
        check:
          _and:
            - edition:
                _and:
                  - current:
                      _eq: true
                  - application_end:
                      _lt: now()
            - goal:
                _gte: 0
            - _or:
                - prev_round_id:
                    _is_null: true
                - prev_round:
                    closed:
                      _eq: true
        columns:
          - edition_id
          - end_at
          - goal
          - prev_round_id
  select_permissions:
    - role: jury
      permission:
        columns:
          - closed
          - created_at
          - edition_id
          - end_at
          - goal
          - id
          - prev_round_id
          - start_at
          - updated_at
        computed_fields:
          - active
          - level
        filter:
          _and:
            - edition:
                current:
                  _eq: true
            - _not:
                next_round: {}
    - role: team
      permission:
        columns:
          - closed
          - created_at
          - edition_id
          - end_at
          - goal
          - id
          - prev_round_id
          - start_at
          - updated_at
        computed_fields:
          - active
          - level
        filter:
          _and:
            - edition:
                current:
                  _eq: true
            - _not:
                next_round: {}
  update_permissions:
    - role: team
      permission:
        columns:
          - closed
          - end_at
          - goal
        filter: {}
        check: null
  delete_permissions:
    - role: team
      permission:
        filter:
          _and:
            - edition:
                _and:
                  - current:
                      _eq: true
                  - winner_id:
                      _is_null: true
            - _not:
                next_round: {}
- table:
    name: rating_rounds_sorted
    schema: public
  object_relationships:
    - name: edition
      using:
        manual_configuration:
          column_mapping:
            edition_id: id
          insertion_order: null
          remote_table:
            name: editions
            schema: public
  select_permissions:
    - role: team
      permission:
        columns:
          - closed
          - edition_id
          - end_at
          - goal
          - id
          - level
          - prev_round_id
          - start_at
        filter: {}
        allow_aggregations: true
- table:
    name: ratings
    schema: public
  object_relationships:
    - name: application
      using:
        foreign_key_constraint_on: application_id
    - name: message
      using:
        foreign_key_constraint_on: message_id
    - name: rating_round
      using:
        foreign_key_constraint_on: round_id
  insert_permissions:
    - role: jury
      permission:
        check:
          rating_round:
            _and:
              - closed:
                  _eq: false
              - _not:
                  next_round: {}
              - end_at:
                  _gte: now()
        set:
          created_by: x-hasura-User-Id
        columns:
          - application_id
          - round_id
          - value
    - role: team
      permission:
        check: {}
        set:
          created_by: x-hasura-User-Id
        columns:
          - application_id
          - round_id
          - value
  select_permissions:
    - role: jury
      permission:
        columns:
          - message_id
          - round_id
          - value
          - created_at
          - updated_at
          - application_id
          - created_by
          - id
        filter: {}
        allow_aggregations: true
    - role: team
      permission:
        columns:
          - id
          - created_at
          - updated_at
          - round_id
          - application_id
          - created_by
          - value
          - message_id
        filter: {}
        allow_aggregations: true
- table:
    name: ratings_by_application
    schema: public
  object_relationships:
    - name: application
      using:
        manual_configuration:
          column_mapping:
            id: id
          insertion_order: null
          remote_table:
            name: applications
            schema: public
    - name: edition
      using:
        manual_configuration:
          column_mapping:
            edition_id: id
          insertion_order: null
          remote_table:
            name: editions
            schema: public
    - name: rating_round
      using:
        manual_configuration:
          column_mapping:
            round_id: id
          insertion_order: null
          remote_table:
            name: rating_rounds
            schema: public
  select_permissions:
    - role: jury
      permission:
        columns:
          - avg
          - avg_total
          - count
          - edition_id
          - id
          - round_id
        filter:
          _and:
            - rating_round:
                _not:
                  next_round: {}
            - edition:
                current:
                  _eq: true
    - role: team
      permission:
        columns:
          - avg
          - avg_total
          - count
          - edition_id
          - id
          - round_id
        filter:
          _and:
            - rating_round:
                _not:
                  next_round: {}
            - edition:
                current:
                  _eq: true
- table:
    name: updates
    schema: public
  object_relationships:
    - name: edition
      using:
        foreign_key_constraint_on: edition_id
  insert_permissions:
    - role: team
      permission:
        check: {}
        columns:
          - edition_id
          - text_de
          - text_en
          - url
  select_permissions:
    - role: jury
      permission:
        columns:
          - created_at
          - edition_id
          - id
          - text_de
          - text_en
          - url
        filter:
          edition:
            current:
              _eq: true
    - role: team
      permission:
        columns:
          - created_at
          - edition_id
          - id
          - text_de
          - text_en
          - url
        filter: {}
    - role: user
      permission:
        columns:
          - created_at
          - edition_id
          - id
          - text_de
          - text_en
          - url
        filter:
          edition:
            current:
              _eq: true
  update_permissions:
    - role: team
      permission:
        columns:
          - text_de
          - text_en
          - url
        filter: {}
        check: null
  delete_permissions:
    - role: team
      permission:
        filter: {}
- table:
    name: users
    schema: public
  array_relationships:
    - name: applications
      using:
        foreign_key_constraint_on:
          column: created_by
          table:
            name: applications
            schema: public
    - name: ratings
      using:
        foreign_key_constraint_on:
          column: created_by
          table:
            name: ratings
            schema: public
  insert_permissions:
    - role: jury
      permission:
        check: {}
        set:
          id: x-hasura-user-id
          type: x-hasura-role
        columns:
          - name
    - role: team
      permission:
        check: {}
        set:
          id: x-hasura-user-id
          type: x-hasura-role
        columns:
          - name
    - role: user
      permission:
        check: {}
        set:
          id: x-hasura-user-id
          type: x-hasura-role
        columns:
          - last_seen
          - name
  select_permissions:
    - role: jury
      permission:
        columns:
          - id
          - last_seen
          - name
          - type
        filter:
          type:
            _ne: user
    - role: team
      permission:
        columns:
          - id
          - last_seen
          - name
          - type
        filter: {}
    - role: user
      permission:
        columns:
          - id
          - last_seen
          - name
          - type
        filter:
          id:
            _eq: X-Hasura-User-Id
  update_permissions:
    - role: jury
      permission:
        columns:
          - last_seen
          - name
        filter:
          id:
            _eq: X-Hasura-User-Id
        check: null
    - role: team
      permission:
        columns:
          - last_seen
          - name
          - type
        filter: {}
        check: null
    - role: user
      permission:
        columns:
          - last_seen
          - name
        filter:
          id:
            _eq: X-Hasura-User-Id
        check: null
  delete_permissions:
    - role: team
      permission:
        filter: {}
    - role: user
      permission:
        filter:
          id:
            _eq: X-Hasura-User-Id
- table:
    name: users_online
    schema: public
- table:
    name: wordlist
    schema: public
- table:
    name: work_files
    schema: public
  object_relationships:
    - name: application
      using:
        foreign_key_constraint_on: application_id
    - name: work
      using:
        foreign_key_constraint_on: work_id
  insert_permissions:
    - role: user
      permission:
        check:
          _and:
            - application:
                _and:
                  - created_by:
                      _eq: X-Hasura-User-Id
                  - edition:
                      _and:
                        - current:
                            _eq: true
                        - application_start:
                            _lte: now()
                        - application_end:
                            _gte: now()
            - work:
                application:
                  created_by:
                    _eq: X-Hasura-User-Id
        columns:
          - application_id
          - password
          - id
          - key
          - mimetype
          - order
          - originalname
          - size
          - work_id
  select_permissions:
    - role: jury
      permission:
        columns:
          - application_id
          - password
          - created_at
          - id
          - key
          - mimetype
          - order
          - originalname
          - size
          - work_id
        filter: {}
        allow_aggregations: true
    - role: team
      permission:
        columns:
          - application_id
          - password
          - created_at
          - id
          - key
          - mimetype
          - order
          - originalname
          - size
          - work_id
        filter: {}
        allow_aggregations: true
    - role: user
      permission:
        columns:
          - application_id
          - password
          - created_at
          - id
          - key
          - mimetype
          - order
          - originalname
          - size
          - work_id
        filter:
          _and:
            - application:
                _and:
                  - created_by:
                      _eq: X-Hasura-User-Id
                  - edition:
                      current:
                        _eq: true
            - work:
                application:
                  created_by:
                    _eq: X-Hasura-User-Id
        allow_aggregations: true
  update_permissions:
    - role: user
      permission:
        columns:
          - order
        filter:
          _and:
            - application:
                _and:
                  - created_by:
                      _eq: X-Hasura-User-Id
                  - edition:
                      _and:
                        - current:
                            _eq: true
                        - application_start:
                            _lte: now()
                        - application_end:
                            _gte: now()
            - work:
                application:
                  created_by:
                    _eq: X-Hasura-User-Id
        check: null
  delete_permissions:
    - role: user
      permission:
        filter:
          _and:
            - application:
                _and:
                  - created_by:
                      _eq: X-Hasura-User-Id
                  - edition:
                      _and:
                        - current:
                            _eq: true
                        - application_start:
                            _lte: now()
                        - application_end:
                            _gte: now()
            - work:
                application:
                  created_by:
                    _eq: X-Hasura-User-Id
  event_triggers:
    - name: delete_firebase_storage_file
      definition:
        delete:
          columns: '*'
        enable_manual: false
      retry_conf:
        interval_sec: 10
        num_retries: 0
        timeout_sec: 60
      webhook: '{{FIREBASE_FUNCTION_ENDPOINT}}/deleteFile'
      headers:
        - name: x-hasura-shared-secret
          value_from_env: FIREBASE_SHARED_SECRET
- table:
    name: work_specification_mediums
    schema: public
  object_relationships:
    - name: category_medium
      using:
        foreign_key_constraint_on: medium_id
    - name: works_specification
      using:
        foreign_key_constraint_on: specification_id
  insert_permissions:
    - role: user
      permission:
        check:
          works_specification:
            application:
              _and:
                - created_by:
                    _eq: X-Hasura-User-Id
                - edition:
                    _and:
                      - current:
                          _eq: true
                      - application_start:
                          _lte: now()
                      - application_end:
                          _gte: now()
        columns:
          - specification_id
          - medium_id
  select_permissions:
    - role: jury
      permission:
        columns:
          - medium_id
          - specification_id
        filter: {}
        allow_aggregations: true
    - role: team
      permission:
        columns:
          - medium_id
          - specification_id
        filter: {}
        allow_aggregations: true
    - role: user
      permission:
        columns:
          - medium_id
          - specification_id
        filter:
          works_specification:
            application:
              created_by:
                _eq: X-Hasura-User-Id
  delete_permissions:
    - role: user
      permission:
        filter:
          works_specification:
            application:
              _and:
                - created_by:
                    _eq: X-Hasura-User-Id
                - edition:
                    _and:
                      - current:
                          _eq: true
                      - application_start:
                          _lte: now()
                      - application_end:
                          _gte: now()
- table:
    name: work_specification_tags
    schema: public
  insert_permissions:
    - role: team
      permission:
        check: {}
        columns:
          - specification_id
          - tag_id
  select_permissions:
    - role: jury
      permission:
        columns:
          - specification_id
          - tag_id
        filter: {}
        allow_aggregations: true
    - role: team
      permission:
        columns:
          - specification_id
          - tag_id
        filter: {}
        allow_aggregations: true
  delete_permissions:
    - role: team
      permission:
        filter: {}
- table:
    name: work_specifications
    schema: public
  object_relationships:
    - name: application
      using:
        foreign_key_constraint_on: application_id
    - name: work
      using:
        foreign_key_constraint_on: work_id
  array_relationships:
    - name: mediums
      using:
        foreign_key_constraint_on:
          column: specification_id
          table:
            name: work_specification_mediums
            schema: public
  insert_permissions:
    - role: user
      permission:
        check:
          _and:
            - application:
                _and:
                  - created_by:
                      _eq: X-Hasura-User-Id
                  - edition:
                      _and:
                        - current:
                            _eq: true
                        - application_start:
                            _lte: now()
                        - application_end:
                            _gte: now()
            - work:
                application:
                  created_by:
                    _eq: X-Hasura-User-Id
        columns:
          - application_id
          - description
          - dimensions_depth
          - dimensions_height
          - dimensions_width
          - id
          - material
          - number_of_editions
          - order
          - title
          - work_id
          - year
  select_permissions:
    - role: jury
      permission:
        columns:
          - application_id
          - created_at
          - description
          - dimensions_depth
          - dimensions_height
          - dimensions_width
          - id
          - material
          - number_of_editions
          - order
          - title
          - updated_at
          - work_id
          - year
        filter: {}
        allow_aggregations: true
    - role: team
      permission:
        columns:
          - application_id
          - created_at
          - description
          - dimensions_depth
          - dimensions_height
          - dimensions_width
          - id
          - material
          - number_of_editions
          - order
          - title
          - updated_at
          - work_id
          - year
        filter: {}
        allow_aggregations: true
    - role: user
      permission:
        columns:
          - application_id
          - created_at
          - description
          - dimensions_depth
          - dimensions_height
          - dimensions_width
          - id
          - material
          - number_of_editions
          - order
          - title
          - updated_at
          - work_id
          - year
        filter:
          _and:
            - application:
                _and:
                  - created_by:
                      _eq: X-Hasura-User-Id
                  - edition:
                      current:
                        _eq: true
            - work:
                application:
                  created_by:
                    _eq: X-Hasura-User-Id
        allow_aggregations: true
  update_permissions:
    - role: user
      permission:
        columns:
          - description
          - dimensions_depth
          - dimensions_height
          - dimensions_width
          - material
          - number_of_editions
          - order
          - title
          - year
        filter:
          _and:
            - application:
                _and:
                  - created_by:
                      _eq: X-Hasura-User-Id
                  - edition:
                      _and:
                        - current:
                            _eq: true
                        - application_start:
                            _lte: now()
                        - application_end:
                            _gte: now()
            - work:
                application:
                  created_by:
                    _eq: X-Hasura-User-Id
        check: null
  delete_permissions:
    - role: user
      permission:
        filter:
          _and:
            - application:
                _and:
                  - created_by:
                      _eq: X-Hasura-User-Id
                  - edition:
                      _and:
                        - current:
                            _eq: true
                        - application_start:
                            _lte: now()
                        - application_end:
                            _gte: now()
            - work:
                application:
                  created_by:
                    _eq: X-Hasura-User-Id
- table:
    name: works
    schema: public
  object_relationships:
    - name: application
      using:
        foreign_key_constraint_on: application_id
  array_relationships:
    - name: files
      using:
        foreign_key_constraint_on:
          column: work_id
          table:
            name: work_files
            schema: public
    - name: specifications
      using:
        foreign_key_constraint_on:
          column: work_id
          table:
            name: work_specifications
            schema: public
  insert_permissions:
    - role: user
      permission:
        check:
          application:
            _and:
              - created_by:
                  _eq: X-Hasura-User-Id
              - edition:
                  _and:
                    - current:
                        _eq: true
                    - application_start:
                        _lte: now()
                    - application_end:
                        _gte: now()
        columns:
          - application_id
          - id
          - order
          - portfolio
  select_permissions:
    - role: jury
      permission:
        columns:
          - application_id
          - created_at
          - id
          - order
          - portfolio
          - updated_at
        filter: {}
        allow_aggregations: true
    - role: team
      permission:
        columns:
          - application_id
          - created_at
          - id
          - order
          - portfolio
          - updated_at
        filter: {}
        allow_aggregations: true
    - role: user
      permission:
        columns:
          - application_id
          - created_at
          - id
          - order
          - portfolio
          - updated_at
        filter:
          application:
            _and:
              - created_by:
                  _eq: X-Hasura-User-Id
              - edition:
                  current:
                    _eq: true
        allow_aggregations: true
  update_permissions:
    - role: user
      permission:
        columns:
          - order
        filter:
          application:
            _and:
              - created_by:
                  _eq: X-Hasura-User-Id
              - edition:
                  _and:
                    - current:
                        _eq: true
                    - application_start:
                        _lte: now()
                    - application_end:
                        _gte: now()
        check: null
  delete_permissions:
    - role: user
      permission:
        filter:
          application:
            _and:
              - created_by:
                  _eq: X-Hasura-User-Id
              - edition:
                  _and:
                    - current:
                        _eq: true
                    - application_start:
                        _lte: now()
                    - application_end:
                        _gte: now()
